# Комментарии к презентации
## слайд 3 о OWASP
OWASP - Open Web Application Security Project

OWASP создал список из 10-и самых опасных векторов атак на Web-приложения, этот список получил название OWASP TOP-10 и в нем сосредоточены самые опасные уязвимости, которые могут стоить некоторым людям больших денег, или подрыва деловой репутации, вплоть до потери бизнеса.

Он признан разработчиками во всем мире как первый шаг к более безопасной разработкe


## слайд 4 Топ 10 рисков безопасности веб-приложений

С 2017 изменилась ротация уязвимостей и некоторые из них в итоге сошлись в одну как например Injection и XSS, XXE и Security misconfiguration. 
Так же появилось несколько новых рисков такие как Insecure Design, Software and Data Integrity Failures и Server-Side Request Forgery (SSRF). Давайте обсудим каждый риск по подробнее.

## слайд 5 - Нарушение контроля доступа - описание и примеры

Нарушение контроля доступа на даный момент самая частая ошибка в веб-приложениях, одно из самых распрастранненых тут это возможность пользователя запросить не свои данные (в тех приложениях которые это обычно запрещают) примеры вы можете видеть на слайде. 
1. Так же часто бывает что не авторизированный пользователь может увидеть или иногда даже использовать админские фичи, что конечно же является большой проблемой безопасности ( в данном случае ограничение на `/admin/**` обычно выполняют на уровне nginx).
2. Самый простой пример это если пользователь попадает на свою страницу - https://somesite.com/users/1000, далее просто меняет ID с 1000 на 1001 и видит страницу другого пользоваля (например его личную информацию).

## слайд 6  - Нарушение контроля доступа - Как предотвратить

* Необходимо по максимуму запрещать все ресурсы, за исключением общедоступных (например swagger или любое описание API по умолчанию должно быть закрыто, если конечно же мы не говорим о специальных системах).
* Необходимо давать всегда минимально необходимые права пользователю, таким образом защищая свою систему от несанкционированного доступа в важные части приложения.
* Советуются добавить rate limit для доступа к API чтобы минимизировать вред от автоматизированных средств атаки.
* Необходимо чтобы токены и индификаторы сессий аннулировались на сервере после выхода из системы, также советуется делать их не долговечными дабы минимизировать возможности переиспользования.

how to -> Open /admin/getappInfo

8001 -> ~/work/owasp/A01_broken_access_control/index.js

## слайд 8 - криптографические неисправности - описание и примеры

В прошлом раскрытие чувствительных данных, который является скорее симптомом, чем первопричиной, основное внимание уделяется сбоям, связанным с криптографией.

Основные слабые места это - хардкод паролей, старые/сломанные криптоалгоритмы
1. Самый простой пример это оставленный в коде тестовый вход с указанием пароля или if с жесткой проверкой пароля (`if (username=admin && password=admin)`).
2. Так же пример который мы рассмотрим позже это например хранение в БД пароля без использования алгоритма шифрования или же с ипользованием слабого алгоритма (или же просто перевод его в bas64), что с легостью позволяет получить пароль пользователя и далее повысить привелегии или же двигаться горизонтально до необходимых привелегий в системе.

## слайд 9 - криптографические неисправности - Как предотвратить

* Классифицируйте данные, обрабатываемые, хранимые или передаваемые приложением. Определите, какие данные являются конфиденциальными и шифруйте их в состоянии при хранении.
* Не храните конфиденциальные данные без нужды.12001400
* Шифруйте все данные при передаче с помощью безопасных протоколов.
* Отключите кэширование для ответов, содержащих конфиденциальные данные.
* Избегайте устаревших криптографических функций и схем набивки, таких как MD5, SHA1.
* Проверяйте эффективность конфигурации и настроек.

Лаба будет позже вместе с SQLi на 8003 порту.

## слайд 10 - Инъекция - описание и примеры

Инъекция один из самых популяных и известных (так же и автоматизированных) рисков. В него входят несколько вещей таких как SQLi, XSS, Command i, SSTI.

Самые популярные примеры обычно содержат в себе SQLi, как например вы видите на слайде. Но также нельзя забывать и об остальных инъекциях. Для command и SSTI надо достаточно много условий, но бывает вам необходимо иметь функционал который может обрабатывать команды 
или же вы пишете небольшой сайт с помощью шаблонов или шаблоны используются в почтовых сообщениях это тоже можно попробовать проэксплуатировать.

Подробные варианты мы рассмотрим на примерах (так же пример с SQLi включает в себя A02 Cryptografic faluires).

## слайд 11 - Инъекция - Как предотвратить

* Всегда валидируйте входные данные от пользователя (как на клиентской части, так и на API), не стоит доверять пользователю.
* Советуется использовать ORM дабы предотвратить SQLi.
* Для любых динамических запросов экранируйте специальные символы, используя специальный синтаксис для данного интерпретатора.

how to -> Open /?cmd=cat flag.txt

8002 -> ~/work/owasp/A02_A03_injection/command/index.js

how to -> `1 union all select username,password from user where id=1`

8003 -> ~/work/owasp/A02_A03_injection/sqli/index.js

how to -> `#{global.process.mainModule.require('child_process').spawnSync('cat', ['flag.txt']).stdout}`

8004 -> ~/work/owasp/A02_A03_injection/ssti/index.js & ~/work/owasp/A02_A03_injection/ssti/index.pug

## слайд 13 - Небезопасный дизайн - описание и примеры

Новая категория на 2021 год посвящена рискам, связанным с недостатками дизайна и архитектуры, как правило это "Генерация сообщения об ошибке, содержащего конфиденциальную информацию" "Незащищенное хранение учетных данных", "Недостаточно защищенные учетные данные".

Из примеров можно взять восстановление пароля через "вопросы и ответы" на данный момент он считается плохим доказательством личности, т.к. многие вещи можно узнать с помощью нынешних социальных сетей или воспользовавшись социальной инженерией.

Еще пример это когда код например имеет ограничения на выполнение единого действия, но при этом можно выполнить данное действие много раз, как пример 2 сценарий, можно купить за раз 15 билетов, но это не ограничивает покупку другим запросом.

Отсутствие границ пользовательского ввода может привести к таким проблемам, как переполнение буфера (buffer overflow). Или же при определенных событиях можно постараться устроить условия гонки (rase conditions).

Чаще всего это баг который граничит с безопастностью, но полностью не является ее частью.

## слайд 14 - Небезопасный дизайн - Как предотвратить

* Постарайтесь создать библиотеку безопасных шаблонов проектирования или готовых к использованию компонентов.
* Интегрируйте формулировки безопасности и элементы управления в пользовательские истории.
* Постарайтесь ограничивать потребление ресурсов пользователем или сервисом.
* Постарайтесь написать модульные и интеграционные тесты для проверки того, что все критические процессы устойчивы к модели угроз.

how to -> Open /restorepass/cucumber

8005 -> ~/work/owasp/A04_insecure_design/index.js

## слайд 16 - Неправильная конфигурация  - описание и примеры

В общем смысле это просто неправильная конфигурация сервера которая носит критический характер для безопасности. 

Как пример это запуск Jenkins сервера с дефолтными параметрами и дефолтными кредами. Или же сервера tomcat с образцами приложений которые имеют проблемы в безопастности.

Второй пример это уровень DEBUG или TRACE для ошибок, то есть API отдает полный лог об ошибке и дополнительную информацию (например как у Django)

## слайд 17 - Неправильная конфигурация  - как предотвратить

* Всегда удаляйте/блокируйте/меняйте пользователя по умолчанию, а так же пароль от данного пользователя, то есть никогда не должно быть airflow/airflow или же tomcat/admin и тп.
* Среды разработки, QA и производства должны быть настроены одинаково, при этом в каждой среде должны использоваться разные учетные данные. Этот процесс должен быть автоматизирован, чтобы минимизировать усилия, необходимые для создания новой безопасной среды. Так же закрывайте все не производственные среды за VPN, для невозможности злоумышлинникам учиться на них или взламывать их.
* Старайтесь делать минимальные платформы (Docker images alpine) дабы на них не было лишних пакетов/уязвимостей, тоже касается и разработки используйте минимально необходимые зависимости при разработке не забывайте проверять и удалять лишние зависимости и лишний код если он не используется.
* Не забывайте обновлять компоненты особенно если они устаревшие или же имеют уязвимости (может помочь в этом SonarQube).

how to -> `curl 'http://127.0.0.1:8001/parser' -X POST -H 'Content-Type: application/xml' -d '<?xml version="1.0" encoding="ISO-8859-1"?><!DOCTYPE foo [<!ELEMENT foo ANY ><!ENTITY xxe SYSTEM "file:///usr/src/app/flag.txt" >]><foo>&xxe;</foo>'`

8010 -> ~/work/owasp/A05_security_misconfiguration/index.js

## слайд 19 - Уязвимые и Устаревшие компонеты - описание и примеры

Думаю из самого названия ясно, что это и каким образом такое бывает, чаще всего в больших компаниях с большой историей, вы можете найти что-то вроде старого сервера с CentOS 5 и доступом по ssh или какой-то старенький nginx на котором вертится что-то вроде сайта визитки и всегда есть возможность попробовать проэксплуаторовать известные уязвимости.
Или же можно с помощью shodan найти определенные сервера которые имеют определенные узявимости и просто пробовать взломать их после чего потребовать выкуп или просто доложить об этом службе безопасности компании.

Как пример вы можете посмотреть на vulnhub и найти итересующую вас технологию с возможностью RCE, например недавно появилась уязвимость у NGINX до 1.20.1 (включительно) версии с возможностью удаленного не авторизированного RCE. (если интересно пок -> https://www.cybersecurity-help.cz/exploits/53543/?ref=bulletin )

## слайд 20 - Уязвимые и Устаревшие компонеты - Как предотвратить

* Так же как и в A05 удаление неиспользуемых зависимостей, ненужных функций, компонентов, файлов и документации.
* Постоянная инвентаризация версий компонентов на стороне клиента и на стороне сервера. Используйте инструменты анализа состава программного обеспечения для автоматизации процесса (так же может помочь SonarQube).
* Получайте компоненты только из официальных источников по защищенным ссылкам. Предпочитайте подписанные пакеты, чтобы снизить вероятность включения в них модифицированного вредоносного компонента.
* Следите за библиотеками и компонентами, которые не поддерживаются или не создают исправлений безопасности для старых версий.

how to -> `curl -v --path-as-is 'http://127.0.0.1:8001/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/opt/flag.txt'`

8007 -> ~/work/owasp/A06_vulnerable_and_outdated_components/Dockerfile

## слайд 22 - Сбои в идентификации и аутентификации - описание и примеры


